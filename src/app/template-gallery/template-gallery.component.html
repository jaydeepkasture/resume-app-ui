<!-- Chat Sidebar -->
<app-chat-sidebar
  (chatSelected)="onChatSelected($event)"
  (sidebarToggled)="onSidebarToggled($event)"
></app-chat-sidebar>

<div class="gallery-container" [class.sidebar-open]="sidebarOpen">
  <div class="gallery-header">
    <h2>Select a Template</h2>
    <div class="gallery-controls">
      <input 
        type="text" 
        placeholder="Search templates..." 
        [(ngModel)]="gallerySearch"
        (input)="applyGalleryFilters()"
        class="gallery-search">
      
      <select [(ngModel)]="galleryFilter" (change)="applyGalleryFilters()" class="gallery-filter">
        <option value="all">All Templates</option>
        <option value="free">Free Edit (HTML)</option>
        <option value="form">Form Edit (Interactive)</option>
      </select>

      <div class="view-toggle">
        <button [class.active]="galleryViewMode === 'grid'" (click)="galleryViewMode = 'grid'" title="Grid View">
           <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>
        </button>
        <button [class.active]="galleryViewMode === 'list'" (click)="galleryViewMode = 'list'" title="List View">
           <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg>
        </button>
      </div>
    </div>
  </div>

  <div class="gallery-content" [class.grid-view]="galleryViewMode === 'grid'" [class.list-view]="galleryViewMode === 'list'">
     <div *ngFor="let theme of filteredBackendTemplates" class="template-card" (click)="onGalleryTemplateSelect(theme)">
        <div class="template-preview">
           <!-- Render HTML Preview for Free Edit templates -->
           <div *ngIf="theme.type === 1 && theme.htmlTemplate" class="html-preview-container">
             <app-template-preview [htmlContent]="theme.htmlTemplate"></app-template-preview>
           </div>
           
           <!-- Render HTML Preview for Form Edit templates (if loaded) -->
           <div *ngIf="theme.type === 2 && theme.htmlTemplate" class="html-preview-container">
             <app-template-preview [htmlContent]="theme.htmlTemplate"></app-template-preview>
           </div>
           
           <!-- Form Edit Preview with Icon (fallback when HTML not loaded yet) -->
           <div *ngIf="theme.type === 2 && !theme.htmlTemplate" class="form-preview-placeholder">
              <svg width="80" height="100" viewBox="0 0 80 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                 <!-- Document outline -->
                 <rect x="10" y="5" width="60" height="90" rx="4" stroke="currentColor" stroke-width="2" fill="white"/>
                 <!-- Header lines -->
                 <line x1="20" y1="15" x2="60" y2="15" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
                 <line x1="20" y1="23" x2="50" y2="23" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" opacity="0.6"/>
                 <!-- Form fields -->
                 <rect x="20" y="32" width="40" height="6" rx="2" fill="currentColor" opacity="0.2"/>
                 <rect x="20" y="42" width="40" height="6" rx="2" fill="currentColor" opacity="0.2"/>
                 <rect x="20" y="52" width="25" height="6" rx="2" fill="currentColor" opacity="0.2"/>
                 <rect x="20" y="62" width="40" height="6" rx="2" fill="currentColor" opacity="0.2"/>
                 <rect x="20" y="72" width="30" height="6" rx="2" fill="currentColor" opacity="0.2"/>
                 <!-- Checkboxes/bullets -->
                 <circle cx="17" cy="35" r="2" fill="currentColor" opacity="0.4"/>
                 <circle cx="17" cy="45" r="2" fill="currentColor" opacity="0.4"/>
                 <circle cx="17" cy="65" r="2" fill="currentColor" opacity="0.4"/>
              </svg>
              <p class="form-label">Interactive Form</p>
           </div>
           
           <!-- Placeholder for missing HTML (Free Edit without template) -->
           <div *ngIf="theme.type === 1 && !theme.htmlTemplate" class="preview-placeholder">
              <span>{{ theme.templateName.charAt(0) }}</span>
           </div>
           
           <div class="template-badge" [class.form-badge]="theme.type === 2">
              {{ theme.type === 2 ? 'Form Edit' : 'Free Edit' }}
           </div>
        </div>
        <div class="template-info">
           <h3>{{ theme.templateName }}</h3>
           <button class="select-btn">Use Template</button>
        </div>
     </div>
     
     <div *ngIf="filteredBackendTemplates.length === 0" class="no-results">
        <p>No templates found matching your criteria.</p>
     </div>
  </div>
</div>
